
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Cross Referencing Overview &#8212; pyXMIP  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=c5ced968eda925caa686" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster.custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster.bundle.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-shadow.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-punk.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-noir.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-light.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/tooltipster-sideTip-borderless.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/micromodal.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=c5ced968eda925caa686" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=c5ced968eda925caa686"></script>

    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/hoverxref.js"></script>
    <script src="../_static/js/tooltipster.bundle.min.js"></script>
    <script src="../_static/js/micromodal.min.js"></script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/Introduction';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo_small.png" class="logo__image only-light" alt="pyXMIP  documentation - Home"/>
    <script>document.write(`<img src="../_static/logo_small.png" class="logo__image only-dark" alt="pyXMIP  documentation - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../user_guide.html">
                        Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../getting_started.html">
                        pyXMIP Quickstart Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../examples.html">
                        Examples
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../user_guide.html">
                        Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../getting_started.html">
                        pyXMIP Quickstart Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../examples.html">
                        Examples
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Cross...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="Cross-Referencing-Overview">
<h1>Cross Referencing Overview<a class="headerlink" href="#Cross-Referencing-Overview" title="Link to this heading">#</a></h1>
<p><img alt="a" src="https://img.shields.io/badge/Subject:-Overview-blue" /> <img alt="b" src="https://img.shields.io/badge/Difficulty:-Easy-green" /> <img alt="c" src="https://img.shields.io/badge/Author:-Eliza_Diggins-green" /></p>
<hr class="docutils" />
<p>This example is intended to give a “bird’s eye” overview of <code class="docutils literal notranslate"><span class="pre">pyXMIP</span></code>, what it can do, how to perform the basic analyses, etc!</p>
<p>Generally speaking, <code class="docutils literal notranslate"><span class="pre">pyXMIP</span></code> is designed with the following steps in mind:</p>
<ol class="arabic simple">
<li><p><strong>Load / explore a source catalog</strong></p>
<ul class="simple">
<li><p>This is where you provide the data that needs to be cross-identified. There are a variety of things <code class="docutils literal notranslate"><span class="pre">pyXMIP</span></code> can do, but almost all of them require you to provide a source catalog as a first step.</p></li>
</ul>
</li>
<li><p><strong>Cross-match</strong></p>
<ul class="simple">
<li><p>The first step in cross-identification (determining a known source as a match to a given detection) is a process which we refer to as “cross-matching”. In the cross-matching step, <code class="docutils literal notranslate"><span class="pre">pyXMIP</span></code> explores a set of external data sources and finds a list (or lists) of <em>potential</em> candidates for the cross-identification of each source in your catalog.</p></li>
</ul>
</li>
<li><p><strong>Reduction</strong></p>
<ul class="simple">
<li><p>In the 3rd step, we go from the cross-matching phase (many possible matches to each source) to the cross-identification phase (one match to a given source). In this part of the process, the user gets to decide how <code class="docutils literal notranslate"><span class="pre">pyXMIP</span></code> should evaluate the “best” match to a given source.</p></li>
</ul>
</li>
<li><p><strong>Science Outcomes</strong></p>
<ul class="simple">
<li><p>The software has done its work, this part is up to you! We provide some tools for performing match quality cutoffs, plotting various aspects of the cross-matching catalog, etc.</p></li>
</ul>
</li>
</ol>
<p>In this guide, we’re going to go through all of these steps for a small example case to showcase the basic ideas!</p>
<hr class="docutils" />
<section id="Contents">
<h2>Contents<a class="headerlink" href="#Contents" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#Loading-Data"><span class="std std-ref">Loading Data</span></a></p>
<ul>
<li><p><a class="reference internal" href="#Schemas"><span class="std std-ref">Schemas</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#Cross-Matching"><span class="std std-ref">Cross Matching</span></a></p>
<ul>
<li><p><a class="reference internal" href="#Cross-Matching-Against-Databases"><span class="std std-ref">Performing the Cross-Match</span></a></p></li>
<li><p><a class="reference internal" href="#Cross-Match-Databases"><span class="std std-ref">Cross Match Databases</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#Reduction"><span class="std std-ref">Reduction</span></a></p></li>
</ul>
</section>
<hr class="docutils" />
<section id="Loading-Data">
<h2>Loading Data<a class="headerlink" href="#Loading-Data" title="Link to this heading">#</a></h2>
<p>The first step is to generate a <code class="docutils literal notranslate"><span class="pre">SourceTable</span></code> containing your catalog of novel sources.</p>
<blockquote>
<div><p>A <code class="docutils literal notranslate"><span class="pre">SourceTable</span></code> is just a fancy version of the typical <code class="docutils literal notranslate"><span class="pre">astropy</span></code> <code class="docutils literal notranslate"><span class="pre">Table</span></code> class. You can treat it more-or-less like a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> or <code class="docutils literal notranslate"><span class="pre">astropy</span></code> table. In addition to basic functionality, these classes also have some specific functions to aid the user (as you’ll see below).</p>
</div></blockquote>
<p>In this example, we’re going to use the <strong>eROSITA X-ray Survey (eRASS1)</strong>! Let’s go ahead and get started by downloading the hard band X-ray catalog <a class="reference external" href="https://erosita.mpe.mpg.de/dr1/AllSkySurveyData_dr1/Catalogues_dr1/MerloniA_DR1/eRASS1_Hard.tar.gz">here</a>. Once it’s been extracted, there should be a file <code class="docutils literal notranslate"><span class="pre">eRASS1_Hard.v1.0.fits</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyXMIP</span> <span class="k">as</span> <span class="nn">pyxmip</span>

<span class="c1"># Load the catalog table just like a normal astropy table.</span>
<span class="n">catalog</span> <span class="o">=</span> <span class="n">pyxmip</span><span class="o">.</span><span class="n">SourceTable</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;data/eRASS1_Hard.v1.0.fits&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Just like any other table, you can look at the catalog data by indexing:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">catalog</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<section id="Schemas">
<h3>Schemas<a class="headerlink" href="#Schemas" title="Link to this heading">#</a></h3>
<p>What makes <code class="docutils literal notranslate"><span class="pre">SourceTable</span></code> instances different from the traditional <code class="docutils literal notranslate"><span class="pre">astropy.Table</span></code> class is that every <code class="docutils literal notranslate"><span class="pre">SourceTable</span></code> comes with a <code class="docutils literal notranslate"><span class="pre">SourceTableSchema</span></code> instance.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">Schema</span></code> classes appear a lot in <code class="docutils literal notranslate"><span class="pre">pyXMIP</span></code>. Effectively, <code class="docutils literal notranslate"><span class="pre">Schema</span></code> classes are how <code class="docutils literal notranslate"><span class="pre">pyXMIP</span></code> figures out what different parts of user-provided data mean. For <code class="docutils literal notranslate"><span class="pre">SourceTable</span></code> instances, this is largely about translating the column names into standardized names that <code class="docutils literal notranslate"><span class="pre">pyXMIP</span></code> understands.</p>
</div></blockquote>
<p>In many cases, the <code class="docutils literal notranslate"><span class="pre">Schema</span></code> may be automatically generated simply by accessing them:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">catschema</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">schema</span>
</pre></div>
</div>
</div>
<blockquote>
<div><p>What’s with all the <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> statements?</p>
<p>Effectively, <code class="docutils literal notranslate"><span class="pre">pyXMIP</span></code> is going through the columns of our catalog and looking for recognizable names. Here, it found <code class="docutils literal notranslate"><span class="pre">RA</span></code> and <code class="docutils literal notranslate"><span class="pre">DEC</span></code> as well as <code class="docutils literal notranslate"><span class="pre">LII</span></code> and <code class="docutils literal notranslate"><span class="pre">BII</span></code> (galactic coordinates). It also found a source name column (<code class="docutils literal notranslate"><span class="pre">IAUNAME</span></code>). Many of the other columns it looked for (like the redshift) weren’t found. Finally, it also determined that there were 2 possible coordinate systems and selected a default (ICRS).</p>
</div></blockquote>
<p>Because <code class="docutils literal notranslate"><span class="pre">SourceCatalog</span></code> instances have <code class="docutils literal notranslate"><span class="pre">Schema</span></code>, we can use general attributes to access data regardless of the column name:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">astropy.units</span> <span class="kn">import</span> <span class="n">Quantity</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">catalog</span><span class="p">)</span><span class="si">}</span><span class="s2"> sources in the catalog.&quot;</span><span class="p">)</span>
<span class="n">_low_gal_lat</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Quantity</span><span class="p">(</span><span class="n">catalog</span><span class="o">.</span><span class="n">GAL_B</span><span class="p">)</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="s2">&quot;deg&quot;</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">_low_gal_lat</span><span class="p">)</span><span class="si">}</span><span class="s2"> sources within the galactic plane.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In some cases, the automatically generated schema is a bit insufficient. For example, in this case, there are RA / DEC error column that weren’t picked up by the naive search. We can add these in manually!</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">catalog</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">column_map</span><span class="o">.</span><span class="n">RA_ERR</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;RA_UPERR&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;arcsec&quot;</span><span class="p">}</span>
<span class="n">catalog</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">column_map</span><span class="o">.</span><span class="n">DEC_ERR</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;DEC_UPERR&quot;</span><span class="p">,</span> <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;arcsec&quot;</span><span class="p">}</span>

<span class="c1"># Fetch the errors</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">catalog</span><span class="o">.</span><span class="n">RA_ERR</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;darkgreen&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Number of eRASS1 Sources&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\sup \sigma_{\mathrm</span><span class="si">{RA}</span><span class="s2">}$, $[\mathrm</span><span class="si">{arcsec}</span><span class="s2">]$&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We can also use the <code class="docutils literal notranslate"><span class="pre">Schema</span></code> to help plot the sources in the catalog!</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># -- create the figure -- #</span>
<span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;aitoff&quot;</span><span class="p">)</span>

<span class="c1"># -- pull the latitute longitude, and rate -- #</span>
<span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="s2">&quot;rad&quot;</span><span class="p">),</span> <span class="n">catalog</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="s2">&quot;rad&quot;</span><span class="p">)</span>
<span class="n">rate</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="s2">&quot;ML_RATE_0&quot;</span><span class="p">]</span>

<span class="c1"># -- plot -- #</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lon</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rate</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gnuplot_r&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;DEC&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;RA&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We can also visualize in galactic coordinates:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># -- create the figure -- #</span>
<span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;aitoff&quot;</span><span class="p">)</span>

<span class="c1"># -- pull the latitute longitude, and rate -- #</span>
<span class="n">coordinates</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">get_coordinates</span><span class="p">()</span><span class="o">.</span><span class="n">transform_to</span><span class="p">(</span><span class="s2">&quot;galactic&quot;</span><span class="p">)</span>

<span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">spherical</span><span class="o">.</span><span class="n">lat</span><span class="o">.</span><span class="n">rad</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">spherical</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">rad</span>

<span class="n">rate</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="s2">&quot;ML_RATE_0&quot;</span><span class="p">]</span>

<span class="c1"># -- plot -- #</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lon</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rate</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gnuplot_r&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$b$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$l$&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<blockquote>
<div><p>You might be wondering why there are so many sources localized to the blob on the lower right?</p>
<p>This is actually because the observing path of the SRG/eROSITA all-sky survey (eRASS1) leads to overlapping exposure in that region of the sky, thus increasing the source detections.</p>
</div></blockquote>
</section>
</section>
<hr class="docutils" />
<section id="Cross-Matching">
<h2>Cross Matching<a class="headerlink" href="#Cross-Matching" title="Link to this heading">#</a></h2>
<p>We’ve suceeded in loading the source catalog, the next step is to <strong>identify potential matches</strong>!</p>
<p><code class="docutils literal notranslate"><span class="pre">pyXMIP</span></code> is developed with the explicit intention of providing the researcher with the versatility to meet their needs while still providing useful tools. To this end, there are a variety of options for determining candidate matches to the catalog sources. Generically, these fall into two categories:</p>
<ul class="simple">
<li><p><strong>Local Database Searches</strong>: The user provides additional catalogs (typically more <code class="docutils literal notranslate"><span class="pre">SourceTables</span></code> or <code class="docutils literal notranslate"><span class="pre">.fits</span></code> files) that are then cross-matched against.</p>
<ul>
<li><p>This is generally a pretty fast process and easily scalable to very large samples.</p></li>
<li><p>The only real restriction is that sources need to have positions on the sky.</p></li>
</ul>
</li>
<li><p><strong>Remote Database Searches</strong>: <code class="docutils literal notranslate"><span class="pre">pyXMIP</span></code> searches through online databases for potential candidates.</p>
<ul>
<li><p>Depending on the database selected, these can be slower; however, they are also searching very large repositories of data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pyXMIP</span></code> unifies the various APIs for different remote databases to provide a uniform user experience.</p></li>
<li><p>Additional remote (and local) databases can be easily written as needed by the user.</p></li>
</ul>
</li>
</ul>
<p>All of these functionalities are contained in the <code class="docutils literal notranslate"><span class="pre">pyXMIP.structures.databases</span></code> module!</p>
<hr class="docutils" />
<p>In order to cross-match our catalog, we have to first find location matches in external databases. All of the available databases are listed in a <code class="docutils literal notranslate"><span class="pre">DBRegistry</span></code> (just a list of available databases). Let’s see what databases are available to use right now:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyXMIP.structures.databases</span> <span class="kn">import</span> <span class="n">DEFAULT_DATABASE_REGISTRY</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">DEFAULT_DATABASE_REGISTRY</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Database </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> corresponds to class </span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> instance </span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<blockquote>
<div><p><strong>Technical Details</strong>:</p>
<p>Every database is an <em>instance</em> of a particular database <em>class</em>. The <em>class</em> represents the generic database (i.e. SIMBAD or NED), while the particular <em>instance</em> represents a given set of search / query parameters and conventions (i.e. what columns to return, what format of coordinates to use, etc.)</p>
<p>All of the built-in databases (NED, SIMBAD, etc.) have a <code class="docutils literal notranslate"><span class="pre">STD</span></code> instance which simply provides the database with default search settings.</p>
</div></blockquote>
<p><strong>All</strong> database instances have a <code class="docutils literal notranslate"><span class="pre">query_radius</span></code> method, which searches the database for sources within a given region.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyXMIP.structures.databases</span> <span class="kn">import</span> <span class="n">NED</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span>

<span class="c1"># Create a default NED instance (default search settings)</span>
<span class="n">ned_instance</span> <span class="o">=</span> <span class="n">NED</span><span class="p">()</span>

<span class="c1"># Search for sources around a position.</span>
<span class="c1"># --------- Example ---------- #</span>
<span class="c1"># Object: Crab Nebula</span>
<span class="c1"># RA: 83.633212, DEC: 22.014460</span>

<span class="n">position</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span>
    <span class="n">ra</span><span class="o">=</span><span class="mf">83.633212</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="mf">22.014460</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span>
<span class="p">)</span>  <span class="c1"># The position to search around</span>
<span class="n">search_radius</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">arcmin</span>  <span class="c1"># The search radius</span>

<span class="c1"># Perform the query</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">ned_instance</span><span class="o">.</span><span class="n">query_radius</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">search_radius</span><span class="p">)</span>

<span class="c1"># Display first 10 results</span>
<span class="n">result</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Just like our <code class="docutils literal notranslate"><span class="pre">catalog</span></code> instance, this is another <code class="docutils literal notranslate"><span class="pre">SourceTable</span></code>! In fact, this one already has a <code class="docutils literal notranslate"><span class="pre">SourceTableSchema</span></code> attached to it!</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
</pre></div>
</div>
</div>
<blockquote>
<div><p><strong>Technical Details</strong>:</p>
<p>Database classes come with a <code class="docutils literal notranslate"><span class="pre">query_schema</span></code>, which tells <code class="docutils literal notranslate"><span class="pre">pyXMIP</span></code> what schema to attach to the results of a given query. This can be super helpful if, for example, you don’t want to have to tell <code class="docutils literal notranslate"><span class="pre">pyXMIP</span></code> what the different columns mean everytime you query NED or SIMBAD.</p>
<p>If you need to query <em>your own database</em>, you might need to provide a <code class="docutils literal notranslate"><span class="pre">query_schema</span></code> to tell <code class="docutils literal notranslate"><span class="pre">pyXMIP</span></code> what it’s looking at!</p>
</div></blockquote>
<p>You may have noticed that the Crab Nebula wasn’t in our list of sources! Databases like NED have a lot of different sources in them from a lot of different missions. This means you often get a lot of “catch-all” objects. We’ll run into this issue again when we talk about <strong>reduction</strong> (going from cross-matching to cross-identification), but we can already make some headway by sorting for specific types of objects!</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter results so that TYPE is SNR (supernova remnant)</span>
<span class="n">filtered_results</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s2">&quot;SNR&quot;</span><span class="p">]</span>

<span class="n">filtered_results</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<section id="Cross-Matching-Against-Databases">
<h3>Cross Matching Against Databases<a class="headerlink" href="#Cross-Matching-Against-Databases" title="Link to this heading">#</a></h3>
<p>Now that you’ve been introduced to the <code class="docutils literal notranslate"><span class="pre">Database</span></code> classes, it’s time to put them to work!</p>
<p>The goal of <strong>cross-matching</strong> is to identify a <em>large</em> number of plausible matches to a particular source quickly. From there, <code class="docutils literal notranslate"><span class="pre">pyXMIP</span></code> will help you “narrow the field” and determine what the best match is (the so-called <strong>reduction</strong> step).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">pyXMIP.cross_reference</span></code> module provides the <code class="docutils literal notranslate"><span class="pre">cross_match_table</span></code> function particularly for this purpose:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyXMIP.cross_reference</span> <span class="kn">import</span> <span class="n">cross_match_table</span>

<span class="c1"># Perform the cross-matching process on the first 100 entries of the catalog.</span>
<span class="n">cross_match_table</span><span class="p">(</span>
    <span class="n">catalog</span><span class="p">[:</span><span class="mi">100</span><span class="p">],</span>
    <span class="s2">&quot;data/cross_matched.db&quot;</span><span class="p">,</span>
    <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">parallel_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<blockquote>
<div><p><strong>Wow! That’s a lot of output!</strong></p>
<p>Here’s what happened: 1. We figured out which databases to cross-match against (in this case, just the default databases). 2. We looked for an existing cross-matching output and deleted pre-existing data. 3. For each database, we search for each catalog source within a specified radius (configurable). All of the results are then compiled and written to disk. 4. The outputs are combined into a single <code class="docutils literal notranslate"><span class="pre">SQL</span></code> database with each table representing a different search database. 5. A bunch of
“post-processing” operations were done to clean up the output and get it ready for use!</p>
</div></blockquote>
<p>The end result of this process is a SQL-database (referred to as a <code class="docutils literal notranslate"><span class="pre">CrossMatchDatabase</span></code>) at <code class="docutils literal notranslate"><span class="pre">data/cross_matched.db</span></code>.</p>
</section>
<section id="Cross-Match-Databases">
<h3>Cross Match Databases<a class="headerlink" href="#Cross-Match-Databases" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">CrossMatchDatabase</span></code> class is the <code class="docutils literal notranslate"><span class="pre">pyXMIP</span></code>-side representation of the underlying <code class="docutils literal notranslate"><span class="pre">SQL</span></code> output from the cross-matching process. It provides a variety of functionality for performing additional analyses on the outputs of your cross-match and (most importantly) provides an interface for the <strong>reduction</strong> step of the cross-identification process.</p>
<p>To load a <code class="docutils literal notranslate"><span class="pre">CrossMatchDatabase</span></code> from disk, you need only provide the path to the file:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load the cross match database from disk</span>
<span class="kn">from</span> <span class="nn">pyXMIP.cross_reference</span> <span class="kn">import</span> <span class="n">CrossMatchDatabase</span>

<span class="n">cmd</span> <span class="o">=</span> <span class="n">CrossMatchDatabase</span><span class="p">(</span><span class="s2">&quot;data/cross_matched.db&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">CrossMatchDatabase</span></code> (reflecting the underlying <code class="docutils literal notranslate"><span class="pre">SQL</span></code>) is composed of “tables”:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The CrossMatchDatabase </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s2"> has tables </span><span class="si">{</span><span class="n">cmd</span><span class="o">.</span><span class="n">tables</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<blockquote>
<div><p><strong>CMD Tables</strong>:</p>
<p>For every <code class="docutils literal notranslate"><span class="pre">Database</span></code> class you cross-matched against, you’ll see a <code class="docutils literal notranslate"><span class="pre">&lt;NAME&gt;_MATCH</span></code> table in your CMD. This contains all of the source candidates from those databases for each of the catalog sources. Additionally, there will always be a <code class="docutils literal notranslate"><span class="pre">CATALOG</span></code> table and a <code class="docutils literal notranslate"><span class="pre">META</span></code> table.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">CATALOG</span></code> table is just a <em>copy</em> of your original catalog. This means that your CMD is entirely self-contained and could (in principle) be used to create a copy of itself.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">META</span></code> table is used for internal book-keeping. Everytime a process or analysis gets run on the CMD, it’s added to <code class="docutils literal notranslate"><span class="pre">META</span></code>. This then allows the CMD to avoid rerunning processes and optimizes various procedures.</p>
</div></blockquote>
<p>Just like a normal <code class="docutils literal notranslate"><span class="pre">SQL</span></code> database, we can run queries on the <code class="docutils literal notranslate"><span class="pre">CrossMatchDatabase</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># -- Example -- #</span>
<span class="c1"># Count the number of proposed matches found in NED for each of the catalog objects.</span>
<span class="n">count_table</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
    <span class="s2">&quot;SELECT CATOBJ,COUNT(&#39;OBJECT NAME&#39;) as N FROM NED_STD_MATCH GROUP BY CATOBJ&quot;</span>
<span class="p">)</span>

<span class="n">count_table</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>  <span class="c1"># show the first 10 matches.</span>
</pre></div>
</div>
</div>
<blockquote>
<div><p>Again, note that most sources have 10+ potential matches. This is why <strong>reduction</strong> is so important for identifying best-candidates.</p>
</div></blockquote>
<p>For some added exploration, let’s create a histogram of the number of matches for each source.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">count_table</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;forestgreen&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Number of matches&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Number of sources&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Apparently one of our sources has <strong>several hundred</strong> matches! Let’s take a closer look.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look up the special source and number of counts.</span>
<span class="n">special_source</span> <span class="o">=</span> <span class="n">count_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">count_table</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">count_table</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]),</span> <span class="p">:]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">special_source</span><span class="p">)</span>

<span class="c1"># Let&#39;s get more detail from EROSITA</span>
<span class="n">catalog_entry</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
    <span class="s2">&quot;SELECT * FROM CATALOG WHERE CATOBJ == &#39;1eRASS J071730.5+374539&#39;&quot;</span>
<span class="p">)</span>

<span class="n">catalog_entry</span><span class="p">[[</span><span class="s2">&quot;LII&quot;</span><span class="p">,</span> <span class="s2">&quot;BII&quot;</span><span class="p">,</span> <span class="s2">&quot;RA&quot;</span><span class="p">,</span> <span class="s2">&quot;DEC&quot;</span><span class="p">,</span> <span class="s2">&quot;EXT_LIKE&quot;</span><span class="p">]]</span>

<span class="n">match_types</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
    <span class="s2">&quot;SELECT Type, COUNT(&#39;OBJECT NAME&#39;) FROM NED_STD_MATCH WHERE CATOBJ == &#39;1eRASS J071730.5+374539&#39; GROUP BY Type&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">match_types</span>
</pre></div>
</div>
</div>
<p>Based on this, we see that there are a number of galaxy clusters (3 - possible referencing the same object) several hundred galaxies and an assortment of other interesting object types.</p>
<p>The question now remains: <em>How do we go from a list of candidate matches to the optimal match?</em></p>
</section>
</section>
<hr class="docutils" />
<section id="Reduction">
<h2>Reduction<a class="headerlink" href="#Reduction" title="Link to this heading">#</a></h2>
<p>It’s the <strong>reduction</strong> stage where <code class="docutils literal notranslate"><span class="pre">pyXMIP</span></code> really shines! Because (as the scientist), you know more about what you need to do than <code class="docutils literal notranslate"><span class="pre">pyXMIP</span></code> ever can, the identification of “best-matches” for each of the catalog objects is a highly configurable procedure.</p>
<p>Starting from the <code class="docutils literal notranslate"><span class="pre">CrossMatchDatabase</span></code> (which has many matches to each catalog source), the <strong>reduction</strong> process takes the following general path:</p>
<ol class="arabic">
<li><p><strong>The user determines what criteria should be used to qualify what makes a particular match “good”</strong></p>
<p>Some of these criteria are pretty standard (i.e. source types are reasonable given the bandpass, the astrometric error is reasonable, etc). Other criteria may be more specific or the catalog being used comes with additional information that can be used to rule out a potential match. Whatever the case may be, each of these criteria constitutes a <code class="docutils literal notranslate"><span class="pre">ReductionProcess</span></code>.</p>
<p>In a technical sense, a <code class="docutils literal notranslate"><span class="pre">ReductionProcess</span></code> is a function which acts on a particular table in your <code class="docutils literal notranslate"><span class="pre">CrossMatchDatabase</span></code> and spits out a values from <span class="math notranslate nohighlight">\(0\)</span> to <span class="math notranslate nohighlight">\(1\)</span> for each possible match such that <span class="math notranslate nohighlight">\(0\)</span> indicates that the source is highly probably (by that metric) to be a match and <span class="math notranslate nohighlight">\(1\)</span> indicates very low likelihood.</p>
</li>
<li><p><strong>The user constructs the relevant reduction process</strong></p>
<p>For very common processes, there is likely already a built-in reduction process available. If not, you may need to write your own. Guidance for doing so is provided in our documentation. This can (sometimes) be a tricky task depending on the complexity of the task and (for large databases), attention should be paid to making the process not only correct, but also efficient.</p>
</li>
<li><p><strong>The reductions are run on the ``CrossMatchDatabase``</strong></p>
<p>Once you’ve created the <code class="docutils literal notranslate"><span class="pre">ReductionProcess</span></code>, it’s easy to run the process on your CMD. We’ll show how to do this below.</p>
</li>
<li><p><strong>Construct a score for each candidate</strong></p>
<p>For each table <span class="math notranslate nohighlight">\(T_i\)</span> in your CMD, there will have been a set of <span class="math notranslate nohighlight">\(N_i\)</span> reduction processes performed. Each candidate (indexed by <span class="math notranslate nohighlight">\(j\)</span>) will have a score (from 0 to 1) for the process <span class="math notranslate nohighlight">\(T_i\)</span>, labeled <span class="math notranslate nohighlight">\(\psi_{ij}\)</span>.</p>
<p>Because different criteria may be of <em>different importance</em> to the user, each process <span class="math notranslate nohighlight">\(T_i\)</span> gets a <em>weight</em> <span class="math notranslate nohighlight">\(\alpha_i\)</span>. The overall score for source <span class="math notranslate nohighlight">\(j\)</span> is then</p>
<div class="math notranslate nohighlight">
\[\xi_j = \frac{1}{Z}\sum_{i} \alpha_i \psi_{ij},\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[Z = \sum_i \alpha_i.\]</div>
</li>
<li><p><strong>Combine scores from different tables</strong></p>
<p>Each reduction process is run on a table individually (you may use the same process on multiple tables, but you don’t <em>have</em> to). Thus, you might end up with different scores from different databases. As such, sources from different tables are <em>combined</em>.</p>
<blockquote>
<div><p><em>What about duplicates?</em></p>
<p>If a potential source appears in two separate tables, then the user may specify a “duplicate-mode” for the scoring (max, min, average, or fixed). If the mode is “fixed”, then a particular table always takes precedence over the others in specifying the true score.</p>
<p>Once the duplicates have been managed, there will be a single score for each candidate source.</p>
</div></blockquote>
<p>The rest is easy! Each source candidate has a score <span class="math notranslate nohighlight">\(\xi_j \in [0,1]\)</span> and the best match is simply the <strong>minimum</strong> score!</p>
</li>
</ol>
<section id="Astrometry-Reduction">
<h3>Astrometry Reduction<a class="headerlink" href="#Astrometry-Reduction" title="Link to this heading">#</a></h3>
<hr class="docutils" />
<p>As an example of a reduction process, we’re going to go through the steps of using an astrometric reduction.</p>
<blockquote>
<div><p>[<strong>Technical Details</strong>]</p>
<p>The <code class="docutils literal notranslate"><span class="pre">AstrometricReductionProcess</span></code> (like all <code class="docutils literal notranslate"><span class="pre">ReductionProcess</span></code> classes) takes the table and <code class="docutils literal notranslate"><span class="pre">CrossMatchDatabase</span></code> it’s operating on as arguments. Additionally, the user must specify either (or both) of <code class="docutils literal notranslate"><span class="pre">CATALOG_ERR</span></code> or <code class="docutils literal notranslate"><span class="pre">DATABASE_ERR</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">CATALOG_ERR</span></code> specifies the astrometric precision of the catalog sources. <code class="docutils literal notranslate"><span class="pre">DATABASE_ERR</span></code> specifies the astrometric precision of the database sources.</p>
<p>Additional resources may be found elsewhere in the documentation with an exhaustive explanation of the details of this procedure.</p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyXMIP.structures.reduction</span> <span class="kn">import</span> <span class="n">AstrometricReductionProcess</span>
<span class="kn">import</span> <span class="nn">pyXMIP</span> <span class="k">as</span> <span class="nn">pyxmip</span>
<span class="kn">from</span> <span class="nn">pyXMIP.cross_reference</span> <span class="kn">import</span> <span class="n">CrossMatchDatabase</span>

<span class="c1"># Load the catalog table just like a normal astropy table.</span>
<span class="n">catalog</span> <span class="o">=</span> <span class="n">pyxmip</span><span class="o">.</span><span class="n">SourceTable</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;data/eRASS1_Hard.v1.0.fits&quot;</span><span class="p">)</span>
<span class="n">cmd</span> <span class="o">=</span> <span class="n">CrossMatchDatabase</span><span class="p">(</span><span class="s2">&quot;data/cross_matched.db&quot;</span><span class="p">)</span>
<span class="n">ARP</span> <span class="o">=</span> <span class="n">AstrometricReductionProcess</span><span class="p">(</span>
    <span class="n">table</span><span class="o">=</span><span class="s2">&quot;NED_STD_MATCH&quot;</span><span class="p">,</span> <span class="n">cross_match_database</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span> <span class="n">CATALOG_ERR</span><span class="o">=</span><span class="p">{},</span> <span class="n">fill_unknown</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Our <code class="docutils literal notranslate"><span class="pre">AstrometricReductionProcess</span></code> is now ready to run. It used the <code class="docutils literal notranslate"><span class="pre">schema</span></code> for the catalog to identify the error columns and it is now set up to procede.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ARP</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Just like that, our <code class="docutils literal notranslate"><span class="pre">AstrometricReductionProcess</span></code> has been completed. You’ll notice it has since appeared in the <code class="docutils literal notranslate"><span class="pre">META</span></code> table:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmd</span><span class="o">.</span><span class="n">meta</span>
</pre></div>
</div>
</div>
<p>Let’s go ahead and take a look at the results of the reduction.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reduction_results</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
    <span class="s2">&quot;SELECT CATOBJ, CATRA, CATDEC, SEPARATION ,CATNMATCH, RA, DEC, ASTROMETRIC_REDUCTION_SCORE FROM NED_STD_MATCH&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="n">reduction_results</span><span class="p">[</span><span class="s2">&quot;ASTROMETRIC_REDUCTION_SCORE&quot;</span><span class="p">],</span>
    <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mf">1e-10</span><span class="p">,</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
    <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;darkgreen&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span>
            <span class="n">reduction_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="n">reduction_results</span><span class="p">[</span><span class="s2">&quot;CATOBJ&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">,</span> <span class="s2">&quot;ASTROMETRIC_REDUCTION_SCORE&quot;</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">reduction_results</span><span class="p">[</span><span class="s2">&quot;CATOBJ&quot;</span><span class="p">]</span>
    <span class="p">],</span>
    <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mf">1e-10</span><span class="p">,</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
    <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Contents">Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Loading-Data">Loading Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Schemas">Schemas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Cross-Matching">Cross Matching</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Cross-Matching-Against-Databases">Cross Matching Against Databases</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Cross-Match-Databases">Cross Match Databases</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Reduction">Reduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Astrometry-Reduction">Astrometry Reduction</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../_sources/examples/Introduction.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=c5ced968eda925caa686"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2024, Eliza Diggins.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>